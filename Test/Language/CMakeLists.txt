cmake_minimum_required(VERSION 3.12)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${BIN_HOME}/Test")
set(core_libs Executor Core PiLang RhoLang TauLang)

macro(build_lang_test lang)
    set(name Test${lang})
    set(home ${TEST_HOME}/Language/${name})
    set(source_path ${home})
    set(header_path ${home}/Include)
    set(script_path ${TEST_HOME}/Scripts/${lang})
    message(STATUS SOURCE ${source_path})
    message(STATUS HEADER ${header_path})
    message(STATUS SCRIPT ${script_path})
    file(GLOB_RECURSE sources ${source_path}/*.cpp)
    list(APPEND sources ${TEST_HOME}/Language/TestLangCommon.cpp)
    list(APPEND sources ${TEST_HOME}/Common/TestCommon.cpp)
    list(APPEND sources ${TEST_HOME}/Common/MyTestStruct.cpp)
    file(GLOB_RECURSE headers ${header_path}/*.h)
    file(GLOB_RECURSE scripts ${header_path}/*.*)
    include_directories(${header_path})
    include_directories(${TEST_HOME}/Include)
    add_definitions(-DKAI_SCRIPT_ROOT=${script_path})
    link_libraries(${core_libs} ${GTEST_BOTH_LIBRARIES} ${Boost_LIBRARIES})
    add_executable(${name} ${sources} ${headers} ${scripts})
    #cotire(${name})
endmacro()

set(langs Pi Rho Tau)
foreach (lang ${langs})
    build_lang_test(${lang})
endforeach()

